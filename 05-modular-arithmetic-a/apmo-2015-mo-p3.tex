\documentclass[../05-modular-arithmetic-a.tex]{subfiles}

\begin{document}

\begin{example*}[\gls{APMO 2015}/P3]\label{example:APMO-2015-MO-P3}\textbf{[\nameref{definition:30M}]}
	Một dãy số thực \( a_0, a_1, \ldots \) được gọi là \textbf{tốt} nếu thỏa mãn ba điều kiện sau:
	\begin{enumerate}[topsep=0pt, partopsep=0pt, itemsep=0pt, label=(\roman*)]
		\item \( a_0 \) là một số nguyên dương.
		\item Với mỗi số nguyên không âm \( i \), ta có:
		\[
			a_{i+1} = 2a_i + 1 \quad \text{hoặc} \quad a_{i+1} = \frac{a_i}{a_i + 2}.
		\]
		\item Tồn tại số nguyên dương \( k \) sao cho \( a_k = 2014 \).
	\end{enumerate}
	
	Tìm số nguyên dương nhỏ nhất \( n \) sao cho tồn tại một dãy tốt \( (a_0, a_1, \ldots) \) với \( a_n = 2014 \).	
\end{example*}

\begin{story*}
    Ta xét \( a_0 \) và biến đổi theo dãy phân số. Đặt \( b_i = \frac{1}{a_i + 1} \), ta thấy dãy \( b_i \) có dạng đệ quy với hai lựa chọn \( \varepsilon_i \in \{0, 1\} \), và \( b_k \) phải bằng \( \frac{1}{2015} \).  
    Vấn đề trở thành việc tìm giá trị nhỏ nhất của \( k \) sao cho \( 2015 \mid 2^k - 1 \), tức là tìm \( \text{ord}_{2015}(2) = k \).
\end{story*}

\bigbreak

\begin{soln}(Cách 1)\footnotemark
	Ta có:
	\[
		a_{i+1} + 1 = 2(a_i + 1) \quad \text{hoặc} \quad a_{i+1} + 1 = \frac{a_i + 2}{a_i + 1}.
	\]
	Suy ra:
	\[
		\frac{1}{a_{i+1} + 1} = \frac{1}{2(a_i + 1)} \quad \text{hoặc} \quad \frac{1}{a_{i+1} + 1} = \frac{1}{2}.
	\]

	Suy ra:
	\[
		\frac{1}{a_k + 1} = \frac{1}{2^k} \left( \frac{1}{a_0 + 1} + \sum_{i = 1}^{k} \varepsilon_i \cdot 2^{i - 1} \right), \tag{1}
	\]
	với \( \varepsilon_i \in \{0, 1\} \).

	Đặt \( a_k = 2014 \implies a_k + 1 = 2015 \), nhân (1) với \( 2^k \cdot 2015 \), ta có:
	\[
		2^k = 2015 \left( \frac{1}{a_0 + 1} + \sum_{i = 1}^{k} \varepsilon_i \cdot 2^{i - 1} \right)
	\implies \frac{1}{a_0 + 1} = \frac{2^k}{2015} - \sum_{i = 1}^{k} \varepsilon_i \cdot 2^{i - 1}.
	\]

	Để \( a_0 + 1 \in \mathbb{Z} \), cần \( 2015 \mid 2^k \), tức là:
	\[
		2015 \mid 2^k - 1.
	\]

	Phân tích: \( 2015 = 5 \cdot 13 \cdot 31 \), với:
	\[
		2^4 \equiv 1 \Mod{5},\quad 2^{12} \equiv 1 \Mod{13},\quad 2^{30} \equiv 1 \Mod{31}
	\implies \text{lcm}(4, 12, 30) = 60.
	\]

	Vì \( \text{ord}_{2015}(2) = 60 \), nên số nhỏ nhất là:
	\[
		\boxed{k = 60}
	\]
\end{soln}

\newpage

\begin{story*}
    Cách tiếp cận thứ hai là đi ngược từ \( a_k = 2014 \) về \( a_0 \) bằng biểu diễn phân số \( \frac{m_i}{n_i} \).  
    Mỗi bước xây dựng dãy phân số tuân theo truy hồi đơn giản, bảo toàn tổng \( m_i + n_i = 2015 \), với \( \gcd(m_i, n_i) = 1 \).  

    Quan sát cho thấy:
    \[
        (m_i, n_i) \equiv (-2^i, 2^i) \pmod{2015}
        \Rightarrow 2^k \equiv 1 \pmod{2015}.
    \]
    Từ đó xác định được giá trị nhỏ nhất của \( k \) cần tìm.
\end{story*}

\begin{soln}(Cách 2)\footnotemark[\value{footnote}]
	Đặt \( a_k = \frac{2014}{1} = \frac{m_0}{n_0} \), và định nghĩa dãy ngược:
	\[
		a_{k-i} = \frac{m_i}{n_i}, \quad i \ge 0
	\]
	với truy hồi:
	\[
		(m_{i+1}, n_{i+1}) =
		\begin{cases}
			(m_i - n_i,\ 2n_i) & \text{nếu } m_i > n_i \\
			(2m_i,\ n_i - m_i) & \text{nếu } m_i < n_i.
		\end{cases}
	\]

	Ta có:
	\[
		m_i + n_i = 2015,\quad \gcd(m_i, n_i) = 1
	\implies (m_i, n_i) \equiv (-2^i, 2^i) \Mod{2015}
	\implies 2^k \equiv 1 \Mod{2015}.
	\]

	Nên số nhỏ nhất là:
	\[
		\boxed{k = 60}
	\]
\end{soln}

\footnotetext{\href{https://www.apmo-official.org/static/solutions/apmo2015_sol.pdf}{Lời giải chính thức.}}

\end{document}